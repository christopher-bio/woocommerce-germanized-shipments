window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(d,o,r,i){var a=function(e){var o=this;o.params=wc_gzd_admin_shipment_modal_params,o.$modalTrigger=e,o.destroy(),o.setup(),o.$modalTrigger.on("click.gzd-modal-"+o.modalId,{adminShipmentModal:o},o.onClick),d(r.body).on("wc_backbone_modal_loaded.gzd-modal-"+o.modalId,{adminShipmentModal:o},o.onOpen).on("wc_backbone_modal_response.gzd-modal-"+o.modalId,{adminShipmentModal:o},o.response).on("wc_backbone_modal_before_remove.gzd-modal-"+o.modalId,{adminShipmentModal:o},o.onClose)};a.prototype.setup=function(){var e=this;e.referenceId=e.$modalTrigger.data("reference")?e.$modalTrigger.data("reference"):0,e.modalClass=e.$modalTrigger.data("id"),e.modalId=e.modalClass+"-"+e.referenceId,e.loadAsync=!!e.$modalTrigger.data("load-async")&&e.$modalTrigger.data("load-async"),e.nonceParams=e.$modalTrigger.data("nonce-params")?e.$modalTrigger.data("nonce-params"):"wc_gzd_admin_shipments_params",e.$modal=!1,e.$modalTrigger.data("self",this)},a.prototype.destroy=function(){var e=this;e.$modalTrigger.off(".gzd-modal-"+e.modalId),d(r).off(".gzd-modal-"+e.modalId),d(r.body).off(".gzd-modal-"+e.modalId)},a.prototype.getShipment=function(e){return d("#panel-order-shipments").find("#shipment-"+e)},a.prototype.onRemoveNotice=function(e){e.data.adminShipmentModal;return d(this).parents(".notice").slideUp(150,function(){d(this).remove()}),!1},a.prototype.onClick=function(e){e=e.data.adminShipmentModal;return e.$modalTrigger.WCBackboneModal({template:e.modalId}),!1},a.prototype.parseFieldId=function(e){return e.replace("[","_").replace("]","")},a.prototype.onExpandMore=function(e){var o=e.data.adminShipmentModal,a=o.$modal.find(".show-more-wrapper"),e=d(this).parents(".show-more-trigger");return a.show(),a.find(":input:visible").trigger("change",[o]),e.find(".show-more").hide(),e.find(".show-fewer").show(),!1},a.prototype.onHideMore=function(e){var o=e.data.adminShipmentModal.$modal.find(".show-more-wrapper"),e=d(this).parents(".show-more-trigger");return o.hide(),e.find(".show-further-services").show(),e.find(".show-fewer-services").hide(),!1},a.prototype.onChangeField=function(e){var o,a=e.data.adminShipmentModal,n=a.$modal,t=a.parseFieldId(d(this).attr("id")),i=d(this).val();!d(this).attr("max")||(e=d(this).attr("max"))<i&&d(this).val(e),!d(this).attr("min")||i<(o=d(this).attr("min"))&&d(this).val(o),d(this).hasClass("show-if-trigger")?0<(o=n.find(d(this).data("show-if"))).length&&(d(this).is(":checked")?o.show():o.hide(),d(r.body).trigger("wc_gzd_admin_shipment_modal_show_if",[a])):(n.find(":input[data-show-if-"+t+"]").parents(".form-field").hide(),d(this).is(":checkbox")?d(this).is(":checked")&&n.find(":input[data-show-if-"+t+"]").parents(".form-field").show():n.find(":input[data-show-if-"+t+'*="'+i+'"]').parents(".form-field").show())},a.prototype.onClose=function(e,o){e=e.data.adminShipmentModal;-1!==o.indexOf(e.modalId)&&e.$modal&&0<e.$modal.length&&e.$modal.off("click.gzd-modal-"+e.modalId)},a.prototype.onOpen=function(e,o){e=e.data.adminShipmentModal;-1!==o.indexOf(e.modalId)&&(e.setup(),e.$modal=d("."+e.modalClass),e.$modal.data("self",e),e.loadAsync?(params={action:e.getAction("load"),reference_id:e.referenceId,security:e.getNonce("load")},e.doAjax(params,e.onLoadSuccess)):e.initData(),d(r.body).trigger("wc_gzd_admin_shipment_modal_open",[e]))},a.prototype.onLoadSuccess=function(e,o){o.initData(),d(r.body).trigger("wc_gzd_admin_shipment_modal_after_load_success",[e,o])},a.prototype.onAjaxSuccess=function(e,o){},a.prototype.onAjaxError=function(e,o){},a.prototype.getModalMainContent=function(){return this.$modal.find("article")},a.prototype.doAjax=function(e,o,a){var n=this,t=n.getModalMainContent();o=o||n.onAjaxSuccess,a=a||n.onAjaxError,e.hasOwnProperty("reference_id")||(e.reference_id=n.referenceId),n.$modal.find(".wc-backbone-modal-content").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.$modal.find(".notice-wrapper").empty(),d.ajax({type:"POST",url:n.params.ajax_url,data:e,success:function(e){e.success?(e.fragments&&d.each(e.fragments,function(e,o){d(e).replaceWith(o)}),n.$modal.find(".wc-backbone-modal-content").unblock(),o.apply(n,[e,n]),i.admin.shipments&&i.admin.shipments.refresh(e),d(r.body).trigger("wc_gzd_admin_shipment_modal_ajax_success",[e,n]),e.fragments&&n.afterRefresh()):(n.$modal.find(".wc-backbone-modal-content").unblock(),a.apply(n,[e,n]),n.printNotices(t,e),t.animate({scrollTop:0},500),d(r.body).trigger("wc_gzd_admin_shipment_modal_ajax_error",[e,n]))},error:function(e){},dataType:"json"})},a.prototype.afterRefresh=function(){0===this.$modal.find(".notice-wrapper").length&&this.getModalMainContent().prepend('<div class="notice-wrapper"></div>'),d(r.body).trigger("wc-enhanced-select-init"),d(r.body).trigger("wc-init-datepickers"),d(r.body).trigger("init_tooltips")},a.prototype.initData=function(){var e=this;e.$modal=d("."+e.modalClass),e.$modal.data("self",e),e.afterRefresh(),e.$modal.on("click.gzd-modal-"+e.modalId,"#btn-ok",{adminShipmentModal:e},e.onSubmit),e.$modal.on("touchstart.gzd-modal-"+e.modalId,"#btn-ok",{adminShipmentModal:e},e.onSubmit),e.$modal.on("keydown.gzd-modal-"+e.modalId,{adminShipmentModal:e},e.onKeyDown),e.$modal.on("click.gzd-modal-"+e.modalId,".notice .notice-dismiss",{adminShipmentModal:e},e.onRemoveNotice),e.$modal.on("change.gzd-modal-"+e.modalId,":input:visible[id]",{adminShipmentModal:e},e.onChangeField),e.$modal.on("click.gzd-modal-"+e.modalId,".show-more",{adminShipmentModal:e},e.onExpandMore),e.$modal.on("click.gzd-modal-"+e.modalId,".show-fewer",{adminShipmentModal:e},e.onHideMore),d(r.body).trigger("wc_gzd_admin_shipment_modal_after_init_data",[e]),e.$modal.find(":input:visible").trigger("change",[e])},a.prototype.printNotices=function(n,e){var t=this;e.hasOwnProperty("message")?t.addNotice(e.message,"error",n):e.hasOwnProperty("messages")&&d.each(e.messages,function(a,e){"string"==typeof e||e instanceof String?t.addNotice(e,"error",n):d.each(e,function(e,o){t.addNotice(o,"soft"===a?"warning":a,n)})})},a.prototype.onSubmitSuccess=function(e,o){var a=o.getModalMainContent();e.hasOwnProperty("messages")&&(e.messages.hasOwnProperty("error")||e.messages.hasOwnProperty("soft"))?(o.printNotices(a,e),o.$modal.find("footer").find("#btn-ok").addClass("modal-close").attr("id","btn-close").text(o.params.i18n_modal_close)):o.$modal.find(".modal-close").trigger("click"),e.hasOwnProperty("shipment_id")&&0<d("div#shipment-"+e.shipment_id).length&&i.admin.shipments.initShipment(e.shipment_id),d(r.body).trigger("wc_gzd_admin_shipment_modal_after_submit_success",[e,o])},a.prototype.getCleanId=function(e=!1){var o=this.modalClass.split("-").join("_").replace("_modal_","_");return o=e?o.replace("wc_gzd_","").replace("wc_gzdp_",""):o},a.prototype.getNonceParams=function(){return o.hasOwnProperty(this.nonceParams)?o[this.nonceParams]:{}},a.prototype.getNonce=function(e){var o=this.getCleanId(!0)+"_"+e+"_nonce",a=this.getNonceParams();return a.hasOwnProperty(o)?a[o]:this.params[e+"_nonce"]},a.prototype.getAction=function(e){return this.getCleanId().replace("wc_","woocommerce_")+"_"+e},a.prototype.onKeyDown=function(o){var a=o.data.adminShipmentModal;13!==(o.keyCode||o.which)||o.target.tagName&&("input"===o.target.tagName.toLowerCase()||"textarea"===o.target.tagName.toLowerCase())||a.onSubmit.apply(a.$modal.find("button#btn-ok"),[e])},a.prototype.getFormData=function(e){var a={};return e.find(".show-more-wrapper").each(function(){d(this).is(":visible")||d(this).addClass("show-more-wrapper-force-show").show()}),d.each(e.find(":input:visible").serializeArray(),function(e,o){-1!==o.name.indexOf("[]")?(o.name=o.name.replace("[]",""),a[o.name]=d.makeArray(a[o.name]),a[o.name].push(o.value)):a[o.name]=o.value}),e.find(".show-more-wrapper-force-show").each(function(){d(this).removeClass("show-more-wrapper-force-show").hide()}),a},a.prototype.onSubmit=function(e){var o=e.data.adminShipmentModal,a=o.getModalMainContent().find("form"),a=o.getFormData(a);a.security=o.getNonce("submit"),a.reference_id=o.referenceId,a.action=o.getAction("submit"),o.doAjax(a,o.onSubmitSuccess),e.preventDefault(),e.stopPropagation()},a.prototype.addNotice=function(e,o,a){a.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+o+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},a.prototype.response=function(e,o,a){e=e.data.adminShipmentModal;-1!==o.indexOf(e.modalId)&&d(r.body).trigger("wc_gzd_admin_shipment_modal_response",[e,a])},d.fn.wc_gzd_admin_shipment_modal=function(){return this.each(function(){return new a(d(this)),this})}}(jQuery,window,document,window.germanized);
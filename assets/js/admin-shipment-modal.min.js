window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(r,o,a,i){var t=function(e){var o=this;o.params=wc_gzd_admin_shipment_modal_params,o.$modalTrigger=e,o.setup(),r(a).on("click.gzd-"+o.modalId,"#"+o.$modalTrigger.attr("id")+":not(.disabled)",{adminShipmentModal:o},o.onClick),r(a.body).on("wc_backbone_modal_loaded.gzd-"+o.modalId,{adminShipmentModal:o},o.onOpen).on("wc_backbone_modal_response.gzd-"+o.modalId,{adminShipmentModal:o},o.response)};t.prototype.setup=function(){var e=this;e.$modalTrigger=r("#"+e.$modalTrigger.attr("id")),e.referenceId=e.$modalTrigger.data("reference")?e.$modalTrigger.data("reference"):0,e.modalClass=e.$modalTrigger.data("id"),e.modalId=e.modalClass+"-"+e.referenceId,e.loadAsync=!!e.$modalTrigger.data("load-async")&&e.$modalTrigger.data("load-async"),e.nonceParams=e.$modalTrigger.data("nonce-params")?e.$modalTrigger.data("nonce-params"):"wc_gzd_admin_shipments_params",e.$modal=!1,e.$modalTrigger.data("self",[this])},t.prototype.destroy=function(){this.$modalTrigger.off("click.gzd-"+this.modalId),r(a.body).off("wc_backbone_modal_loaded.gzd-"+this.modalId).off("wc_backbone_modal_response.gzd-"+this.modalId)},t.prototype.getShipment=function(e){return r("#panel-order-shipments").find("#shipment-"+e)},t.prototype.onRemoveNotice=function(e){e.data.adminShipmentModal;return r(this).parents(".notice").slideUp(150,function(){r(this).remove()}),!1},t.prototype.onClick=function(e){e=e.data.adminShipmentModal;return e.$modalTrigger.WCBackboneModal({template:e.modalId}),!1},t.prototype.parseFieldId=function(e){return e.replace("[","_").replace("]","")},t.prototype.onExpandMore=function(e){var o=e.data.adminShipmentModal,a=o.$modal.find(".show-more-wrapper"),e=r(this).parents(".show-more-trigger");return a.show(),a.find(":input:visible").trigger("change",[o]),e.find(".show-more").hide(),e.find(".show-fewer").show(),!1},t.prototype.onHideMore=function(e){var o=e.data.adminShipmentModal.$modal.find(".show-more-wrapper"),e=r(this).parents(".show-more-trigger");return o.hide(),e.find(".show-further-services").show(),e.find(".show-fewer-services").hide(),!1},t.prototype.onChangeField=function(e){var o,a=e.data.adminShipmentModal,t=a.$modal,n=a.parseFieldId(r(this).attr("id")),i=r(this).val();!r(this).attr("max")||(e=r(this).attr("max"))<i&&r(this).val(e),!r(this).attr("min")||i<(o=r(this).attr("min"))&&r(this).val(o),r(this).hasClass("show-if-trigger")?0<(o=t.find(r(this).data("show-if"))).length&&(r(this).is(":checked")?o.show():o.hide(),a.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_show_if",[a])):(t.find(":input[data-show-if-"+n+"]").parents(".form-field").hide(),r(this).is(":checkbox")?r(this).is(":checked")&&t.find(":input[data-show-if-"+n+"]").parents(".form-field").show():t.find(":input[data-show-if-"+n+'*="'+i+'"]').parents(".form-field").show())},t.prototype.onOpen=function(e,o){e=e.data.adminShipmentModal;-1!==o.indexOf(e.modalId)&&(e.setup(),e.$modal=r("."+e.modalClass),e.$modal.data("self",e),e.loadAsync?(params={action:e.getAction("load"),reference_id:e.referenceId,security:e.getNonce("load")},e.doAjax(params,e.onLoadSuccess)):e.initData(),e.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_open",[e]))},t.prototype.onLoadSuccess=function(e,o){o.initData(),o.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_after_load_success",[e,o])},t.prototype.onAjaxSuccess=function(e,o){},t.prototype.onAjaxError=function(e,o){},t.prototype.getModalMainContent=function(){return this.$modal.find("article")},t.prototype.doAjax=function(e,o,a){var t=this,n=t.getModalMainContent();o=o||t.onAjaxSuccess,a=a||t.onAjaxError,e.hasOwnProperty("reference_id")||(e.reference_id=t.referenceId),t.$modal.find(".wc-backbone-modal-content").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.$modal.find(".notice-wrapper").empty(),r.ajax({type:"POST",url:t.params.ajax_url,data:e,success:function(e){e.success?(e.fragments&&r.each(e.fragments,function(e,o){r(e).replaceWith(o)}),t.$modal.find(".wc-backbone-modal-content").unblock(),o.apply(t,[e,t]),i.admin.shipments&&i.admin.shipments.refresh(e),t.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_ajax_success",[e,t]),e.fragments&&t.afterRefresh()):(t.$modal.find(".wc-backbone-modal-content").unblock(),a.apply(t,[e,t]),t.printNotices(n,e),n.animate({scrollTop:0},500),t.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_ajax_error",[e,t]))},error:function(e){},dataType:"json"})},t.prototype.afterRefresh=function(){0===this.$modal.find(".notice-wrapper").length&&this.getModalMainContent().prepend('<div class="notice-wrapper"></div>'),r(a.body).trigger("wc-enhanced-select-init"),r(a.body).trigger("wc-init-datepickers"),r(a.body).trigger("init_tooltips")},t.prototype.initData=function(){var e=this;e.$modal=r("."+e.modalClass),e.$modal.data("self",e),e.afterRefresh(),e.$modal.on("click.gzd-"+e.modalId,"#btn-ok",{adminShipmentModal:e},e.onSubmit),e.$modal.on("touchstart.gzd-"+e.modalId,"#btn-ok",{adminShipmentModal:e},e.onSubmit),e.$modal.on("keydown.gzd-"+e.modalId,{adminShipmentModal:e},e.onKeyDown),e.$modal.on("click.gzd-"+e.modalId,".notice .notice-dismiss",{adminShipmentModal:e},e.onRemoveNotice),e.$modal.on("change.gzd-"+e.modalId,":input:visible[id]",{adminShipmentModal:e},e.onChangeField),e.$modal.on("click.gzd-"+e.modalId,".show-more",{adminShipmentModal:e},e.onExpandMore),e.$modal.on("click.gzd-"+e.modalId,".show-fewer",{adminShipmentModal:e},e.onHideMore),e.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_after_init_data",[e]),e.$modal.find(":input:visible").trigger("change",[e])},t.prototype.printNotices=function(t,e){var n=this;e.hasOwnProperty("message")?n.addNotice(e.message,"error",t):e.hasOwnProperty("messages")&&r.each(e.messages,function(a,e){"string"==typeof e||e instanceof String?n.addNotice(e,"error",t):r.each(e,function(e,o){n.addNotice(o,"soft"===a?"warning":a,t)})})},t.prototype.onSubmitSuccess=function(e,o){var a=o.getModalMainContent();e.hasOwnProperty("messages")&&(e.messages.hasOwnProperty("error")||e.messages.hasOwnProperty("soft"))?(o.printNotices(a,e),o.$modal.find("footer").find("#btn-ok").addClass("modal-close").attr("id","btn-close").text(o.params.i18n_modal_close)):o.$modal.find(".modal-close").trigger("click"),e.hasOwnProperty("shipment_id")&&0<r("div#shipment-"+e.shipment_id).length&&i.admin.shipments.initShipment(e.shipment_id),o.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_after_submit_success",[e,o])},t.prototype.getCleanId=function(e=!1){var o=this.modalClass.split("-").join("_").replace("_modal_","_");return o=e?o.replace("wc_gzd_","").replace("wc_gzdp_",""):o},t.prototype.getNonceParams=function(){return o.hasOwnProperty(this.nonceParams)?o[this.nonceParams]:{}},t.prototype.getNonce=function(e){var o=this.getCleanId(!0)+"_"+e+"_nonce",a=this.getNonceParams();return a.hasOwnProperty(o)?a[o]:this.params[e+"_nonce"]},t.prototype.getAction=function(e){return this.getCleanId().replace("wc_","woocommerce_")+"_"+e},t.prototype.onKeyDown=function(o){var a=o.data.adminShipmentModal;13!==(o.keyCode||o.which)||o.target.tagName&&("input"===o.target.tagName.toLowerCase()||"textarea"===o.target.tagName.toLowerCase())||a.onSubmit.apply(a.$modal.find("button#btn-ok"),[e])},t.prototype.getFormData=function(e){var a={};return e.find(".show-more-wrapper").each(function(){r(this).is(":visible")||r(this).addClass("show-more-wrapper-force-show").show()}),r.each(e.find(":input:visible").serializeArray(),function(e,o){-1!==o.name.indexOf("[]")?(o.name=o.name.replace("[]",""),a[o.name]=r.makeArray(a[o.name]),a[o.name].push(o.value)):a[o.name]=o.value}),e.find(".show-more-wrapper-force-show").each(function(){r(this).removeClass("show-more-wrapper-force-show").hide()}),a},t.prototype.onSubmit=function(e){var o=e.data.adminShipmentModal,a=o.getModalMainContent().find("form"),a=o.getFormData(a);a.security=o.getNonce("submit"),a.reference_id=o.referenceId,a.action=o.getAction("submit"),o.doAjax(a,o.onSubmitSuccess),e.preventDefault(),e.stopPropagation()},t.prototype.addNotice=function(e,o,a){a.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+o+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},t.prototype.response=function(e,o,a){e=e.data.adminShipmentModal;-1!==o.indexOf(e.modalId)&&e.$modalTrigger.trigger("wc_gzd_admin_shipment_modal_response",[e,a])},r.fn.wc_gzd_admin_shipment_modal=function(){return this.each(function(){return new t(r(this)),this})}}(jQuery,window,document,window.germanized);
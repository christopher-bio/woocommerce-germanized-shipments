window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(h){h.GermanizedShipment=function(t){this.vars={$shipment:!1,params:{},id:"",isEditable:!0,needsItems:!0},(this.root=this).construct=function(t){this.vars.id=t,this.vars.params=germanized.admin.shipments.getParams(),this.refreshDom(),h(document.body).on("wc_backbone_modal_loaded",this.backbone.init.bind(this)).on("wc_backbone_modal_response",this.backbone.response.bind(this))},this.refreshDom=function(){this.vars.$shipment=h("#order-shipments-list").find("#shipment-"+this.getId()),this.setNeedsItems(this.vars.$shipment.hasClass("needs-items")),this.setIsEditable(this.vars.$shipment.hasClass("is-editable")),h("#shipment-"+this.vars.id).off(),h("#shipment-"+this.vars.id).on("change",".item-quantity",this.onChangeQuantity.bind(this)).on("click","a.remove-shipment-item",this.onRemoveItem.bind(this)).on("click","a.add-shipment-item",this.onAddItem.bind(this)).on("click","a.sync-shipment-items",this.onSyncItems.bind(this))},this.getShipment=function(){return this.vars.$shipment},this.onChangeQuantity=function(t){var i=h(t.target),e=i.parents(".shipment-item").data("id"),n=i.val();this.blockItems();var s={action:"woocommerce_gzd_limit_shipment_item_quantity",shipment_id:this.getId(),item_id:e,quantity:n};germanized.admin.shipments.doAjax(s,this.onChangeQuantitySuccess.bind(this))},this.onChangeQuantitySuccess=function(t){var i=this.getShipment().find('.shipment-item[data-id="'+t.item_id+'"]'),e=i.find(".item-quantity").val(),n=t.max_quantity;n<e&&i.find(".item-quantity").val(n),this.unblockItems()},this.setWeight=function(t){this.getShipment().find("#shipment-weight-"+this.getId()).attr("placeholder",t)},this.setLength=function(t){this.getShipment().find("#shipment-length-"+this.getId()).attr("placeholder",t)},this.setWidth=function(t){this.getShipment().find("#shipment-width-"+this.getId()).attr("placeholder",t)},this.setHeight=function(t){this.getShipment().find("#shipment-height-"+this.getId()).attr("placeholder",t)},this.setIsEditable=function(t){var e=this;"boolean"!=typeof t&&(t=!0),this.vars.isEditable=!0===t,this.vars.isEditable?(this.getShipment().addClass("is-editable"),this.getShipment().removeClass("is-locked"),this.getShipment().find(".remove-shipment-item ").show(),this.getShipment().find(".shipment-item-actions").show(),this.getShipment().find(":input:not([type=hidden])").prop("disabled",!1)):(this.getShipment().removeClass("is-editable"),this.getShipment().addClass("is-locked"),this.getShipment().find(".remove-shipment-item ").hide(),this.getShipment().find(".shipment-item-actions").hide(),this.getShipment().find(":input:not([type=hidden])").prop("disabled",!0),h.each(this.vars.params.shipment_locked_excluded_fields,function(t,i){e.getShipment().find(":input[name^=shipment_"+i+"]").prop("disabled",!1)}))},this.setNeedsItems=function(t){"boolean"!=typeof t&&(t=!0),this.vars.needsItems=!0===t,this.vars.needsItems?this.getShipment().addClass("needs-items"):this.getShipment().removeClass("needs-items")},this.onSyncItems=function(){return this.syncItems(),!1},this.syncItems=function(){this.blockItems();var t={action:"woocommerce_gzd_sync_shipment_items",shipment_id:this.getId()};germanized.admin.shipments.doAjax(t,this.onSyncItemsSuccess.bind(this),this.onSyncItemsError.bind(this))},this.onSyncItemsSuccess=function(t){this.unblockItems()},this.onSyncItemsError=function(t){this.unblockItems()},this.onAddItem=function(){return this.getShipment().WCBackboneModal({template:"wc-gzd-dhl-modal-add-shipment-item-"+this.getId()}),!1},this.addItem=function(t,i){i=i||1,this.blockItems();var e={action:"woocommerce_gzd_add_shipment_item",shipment_id:this.getId(),order_item_id:t,quantity:i};germanized.admin.shipments.doAjax(e,this.onAddItemSuccess.bind(this),this.onAddItemError.bind(this))},this.onAddItemError=function(t){this.unblockItems()},this.onAddItemSuccess=function(t){this.getShipment().find(".shipment-item-list").append(t.new_item),this.refreshDom(),this.unblockItems()},this.onRemoveItem=function(t){var i=h(t.target).parents(".shipment-item"),e=i.data("id");return 0<i.length&&this.removeItem(e),!1},this.blockItems=function(){this.getShipment().find(".shipment-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblockItems=function(){this.getShipment().find(".shipment-items").unblock()},this.removeItem=function(t){this.getShipment().find('.shipment-item[data-id="'+t+'"]');var i={action:"woocommerce_gzd_remove_shipment_item",shipment_id:this.getId(),item_id:t};this.blockItems(),germanized.admin.shipments.doAjax(i,this.onRemoveItemSuccess.bind(this))},this.onRemoveItemSuccess=function(t){var i=this.getShipment().find('.shipment-item[data-id="'+t.item_id+'"]');0<i.length&&i.slideUp(150,function(){h(this).remove()}),this.unblockItems()},this.getId=function(){return this.vars.id},this.backbone={onAddItemSuccess:function(t){h(".wc-backbone-modal-content article").unblock(),$select=h("select#wc-gzd-dhl-add-order-items-select"),$quantity=h("input#wc-gzd-dhl-add-order-items-quantity"),$quantity.val(1),h.each(t.items,function(t,i){$select.append('<option value="'+t+'">'+i.name+"</option>"),$quantity.data("max-quantity-"+t,i.max_quantity)}),h(document.body).on("change","input#wc-gzd-dhl-add-order-items-quantity",function(){var t=$select.val(),i=h(this).val();if($quantity.data("max-quantity-"+t)){var e=$quantity.data("max-quantity-"+t);e<i&&$quantity.val(e)}})},init:function(t,i){var e=this.getId();if("wc-gzd-dhl-modal-add-shipment-item-"+e===i)return h(".wc-backbone-modal-content article").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),germanized.admin.shipments.doAjax({action:"woocommerce_gzd_get_shipment_available_order_items",shipment_id:e},this.backbone.onAddItemSuccess.bind(this)),!1},response:function(t,i,e){"wc-gzd-dhl-modal-add-shipment-item-"+this.getId()===i&&this.addItem(e.item_id,e.item_qty)}},this.construct(t)}}(jQuery,window.germanized.admin);
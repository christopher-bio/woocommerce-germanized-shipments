window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(i){window.germanized.admin.shipments_export={params:{},init:function(){var n=germanized.admin.shipments_export;n.params=wc_gzd_admin_shipments_export_params,n.dates=i(".range_datepicker").datepicker({changeMonth:!0,changeYear:!0,defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,minDate:"-20Y",maxDate:"+1D",showButtonPanel:!0,showOn:"focus",buttonImageOnly:!0,onSelect:function(){var e=i(this).is(".from")?"minDate":"maxDate",t=i(this).datepicker("getDate");n.dates.not(this).datepicker("option",e,t)}}),i(document).on("click",".export-date-adjuster",n.onAdjustDate).on("submit",".wc-gzd-shipments-create-export",n.onCreateExport).on("click",".export-button-continue",n.continueExport);var e=i(".wc-gzd-shipments-export");0<e.length&&e.data("autostart")&&n.editExport("run")},continueExport:function(){var e=i(".wc-gzd-shipments-export"),t=germanized.admin.shipments_export;return e.find(".notice-wrapper").empty(),e.find(".export-button-continue").hide(),t.editExport("continue"),!1},editExport:function(e){var n=i(".wc-gzd-shipments-export"),t=germanized.admin.shipments_export,a=n.serializeArray();return a.export_action=e,i.ajax({type:"POST",url:t.params.ajax_url,data:a,dataType:"json",success:function(e){n.find(".notice-wrapper").empty(),n.find(".wc-gzd-shipments-export-progress").val(e.percentage),n.find(".export-button-continue").hide(),i.each(e.error_messages,function(e,t){n.find(".notice-wrapper").append('<div class="notice notice-error"><p>'+t+"</p></div>")}),"completed"===e.status?window.location.reload():"halted"===e.status?n.find(".export-button-continue").show():t.editExport("run")}}).fail(function(e){window.console.log(e)}),!1},onCreateExport:function(){var t=i(this),e=germanized.admin.shipments_export,n={};return i.each(t.serializeArray(),function(e,t){-1!==t.name.indexOf("[]")?(t.name=t.name.replace("[]",""),n[t.name]=i.makeArray(n[t.name]),n[t.name].push(t.value)):n[t.name]=t.value}),i(".wc-gzd-shipments-export-wrapper").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),i.ajax({type:"POST",url:e.params.ajax_url,data:n,dataType:"json",success:function(e){t.find(".notice-wrapper .notice").remove(),e.success?window.location=e.url:(e.hasOwnProperty("messages")&&i.each(e.messages,function(e,t){i(".notice-wrapper").append('<div class="notice is-dismissible notice-error"><p>'+t+'</p><button type="button" class="notice-dismiss"></button></div>')}),i(".wc-gzd-shipments-export-wrapper").unblock())}}).fail(function(e){window.console.log(e)}),!1},onAdjustDate:function(){var e=i(this),t=germanized.admin.shipments_export.dates,n=new Date;return"current_month"===e.data("adjust")?(i(t[0]).datepicker("setDate",new Date(n.getFullYear(),n.getMonth(),1)),i(t[1]).datepicker("setDate",new Date(n.getFullYear(),n.getMonth()+1,0))):"last_month"===e.data("adjust")&&(i(t[0]).datepicker("setDate",new Date(n.getFullYear(),n.getMonth()-1,1)),i(t[1]).datepicker("setDate",new Date(n.getFullYear(),n.getMonth(),0))),!1}},i(document).ready(function(){germanized.admin.shipments_export.init()})}(jQuery);
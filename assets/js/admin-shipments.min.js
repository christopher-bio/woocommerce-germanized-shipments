window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(m){window.germanized.admin.shipments={params:{},shipments:{},$wrapper:!1,needsSaving:!1,needsShipments:!0,init:function(){var e=germanized.admin.shipments;e.params=wc_gzd_admin_shipments_params,e.$wrapper=m("#panel-order-shipments"),e.needsShipments=e.$wrapper.find("#order-shipment-add").is(":visible"),e.initShipments(),m(document).ajaxComplete(e.onAjaxComplete),m(document).on("click","#order-shipments-list .shipment-header",e.onToggleShipment).on("change","#order-shipments-list :input:visible",e.setNeedsSaving).on("click","#panel-order-shipments #order-shipment-add",e.onAddShipment).on("click","#panel-order-shipments .remove-shipment",e.onRemoveShipment).on("click","#panel-order-shipments button#order-shipments-save",e.onSave).on("click","#panel-order-shipments .notice-dismiss",e.onRemoveNotice)},onAjaxComplete:function(e,n,i){var t=germanized.admin.shipments;if(null!=n&&i.hasOwnProperty("data")){var r=i.data,s=!1;try{s=JSON.parse('{"'+r.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,n){return""===e?n:decodeURIComponent(n)})}catch(e){s=!1}if(s&&s.hasOwnProperty("action")){var a=s.action;"woocommerce_save_order_items"!==a&&"woocommerce_remove_order_item"!==a&&"woocommerce_add_order_item"!==a&&"woocommerce_delete_refund"!==a||t.syncItemQuantities()}}},syncItemQuantities:function(){var e=germanized.admin.shipments;e.block();var n={action:"woocommerce_gzd_validate_shipment_item_quantities",active:e.getActiveShipmentId()};e.doAjax(n,e.onSyncSuccess)},onSyncSuccess:function(e){var n=germanized.admin.shipments;n.unblock(),n.initShipments(),n.initTiptip()},onSave:function(e){var n=germanized.admin.shipments;return e.preventDefault(),n.save(),!1},save:function(){var e=germanized.admin.shipments;e.block();var n={action:"woocommerce_gzd_save_shipments",active:e.getActiveShipmentId()};e.doAjax(n,e.onSaveSuccess)},onSaveSuccess:function(e){var n=germanized.admin.shipments;n.initShipments(),n.setNeedsSaving(!1),n.unblock(),n.initTiptip()},getActiveShipmentId:function(){var e=germanized.admin.shipments.$wrapper.find(".order-shipment.active");return 0<e.length&&e.data("shipment")},block:function(){germanized.admin.shipments.$wrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){germanized.admin.shipments.$wrapper.unblock()},getData:function(e){var i=germanized.admin.shipments.$wrapper.find(":input[name]").serializeArray();return e=e||{},m.each(e,function(e,n){i.push({name:e,value:n})}),i},doAjax:function(e,n,t){var r=germanized.admin.shipments,i=r.params.ajax_url,s=r.$wrapper,a=!0;s.find(".notice-wrapper").empty(),n=n||r.onAjaxSuccess,t=t||r.onAjaxError,e.hasOwnProperty("refresh_fragments")&&(a=e.refresh_fragments),e.hasOwnProperty("security")||(e.security=r.params.edit_shipments_nonce),e.hasOwnProperty("order_id")||(e.order_id=r.params.order_id),e=r.getData(e),m.ajax({type:"POST",url:i,data:e,success:function(e){if(e.success){a&&e.fragments&&m.each(e.fragments,function(e,n){m(e).replaceWith(n),m(e).unblock()}),n.apply(s,[e]),e.hasOwnProperty("order_needs_new_shipments")&&r.setNeedsShipments(e.order_needs_new_shipments);var i=e.hasOwnProperty("shipments")?e.shipments:{};m.each(r.getShipments(),function(e,n){i.hasOwnProperty(e)&&(n.setIsEditable(i[e].is_editable),n.setNeedsItems(i[e].needs_items))})}else t.apply(s,[e]),r.unblock(),e.hasOwnProperty("message")&&r.addNotice(e.message,"error")},error:function(e){t.apply(s,[e])},dataType:"json"})},onAjaxError:function(e){},onAjaxSuccess:function(e){},onRemoveNotice:function(){m(this).parents(".notice").slideUp(150,function(){m(this).remove()})},addNotice:function(e,n){germanized.admin.shipments.$wrapper.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},getParams:function(){return germanized.admin.shipments.params},onRemoveShipment:function(){var e=germanized.admin.shipments,n=m(this).parents(".order-shipment").data("shipment");return window.confirm(e.getParams().i18n_remove_shipment_notice)&&e.removeShipment(n),!1},removeShipment:function(e){var n=germanized.admin.shipments,i={action:"woocommerce_gzd_remove_shipment",shipment_id:e};n.block(),n.doAjax(i,n.onRemoveShipmentSuccess,n.onRemoveShipmentError)},onRemoveShipmentSuccess:function(e){var n=germanized.admin.shipments,i=n.$wrapper.find("#shipment-"+e.shipment_id);0<i.length&&(i.hasClass("active")?i.find(".shipment-content-wrapper").slideUp(300,function(){i.removeClass("active"),i.remove()}):i.remove()),n.initShipments(),n.unblock()},onRemoveShipmentError:function(e){germanized.admin.shipments.unblock()},onAddShipment:function(){return germanized.admin.shipments.addShipment(),!1},addShipment:function(){var e=germanized.admin.shipments;e.block(),e.doAjax({action:"woocommerce_gzd_add_shipment"},e.onAddShipmentSuccess,e.onAddShipmentError)},onAddShipmentSuccess:function(e){var n=germanized.admin.shipments;0<n.$wrapper.find(".order-shipment.active").length?n.$wrapper.find(".order-shipment.active").find(".shipment-content-wrapper").slideUp(300,function(){n.$wrapper.find(".order-shipment.active").removeClass("active"),n.$wrapper.find("#order-shipments-list").append(e.new_shipment),n.initShipments(),n.unblock()}):(n.$wrapper.find("#order-shipments-list").append(e.new_shipment),n.initShipments(),n.unblock())},onAddShipmentError:function(e){},setNeedsSaving:function(e){var n=germanized.admin.shipments;"boolean"!=typeof e&&(e=!0),n.needsSaving=!0===e,n.needsSaving?n.$wrapper.find("#order-shipments-save").show():n.$wrapper.find("#order-shipments-save").hide(),n.hideOrShowFooter()},setNeedsShipments:function(e){var n=germanized.admin.shipments;"boolean"!=typeof e&&(e=!0),n.needsShipments=!0===e,n.needsShipments?(n.$wrapper.addClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").show()):(n.$wrapper.removeClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").hide()),n.hideOrShowFooter()},hideOrShowFooter:function(){var e=germanized.admin.shipments;e.needsSaving||e.needsShipments?e.$wrapper.find(".panel-footer").slideDown(300):e.$wrapper.find(".panel-footer").slideUp(300)},onToggleShipment:function(){var e=germanized.admin.shipments,n=m(this).parents(".order-shipment"),i=n.hasClass("active");e.closeShipments(),i||n.find(".shipment-content-wrapper").slideDown(300,function(){n.addClass("active")})},closeShipments:function(){var e=germanized.admin.shipments;e.$wrapper.find(".order-shipment.active .shipment-content-wrapper").slideUp(300,function(){e.$wrapper.find(".order-shipment.active").removeClass("active")})},initShipments:function(){var n=germanized.admin.shipments;n.$wrapper.find(".order-shipment").each(function(){var e=m(this).data("shipment");n.shipments.hasOwnProperty(e)?n.shipments[e].refreshDom():n.shipments[e]=new m.GermanizedShipment(e)})},getShipments:function(){return germanized.admin.shipments.shipments},getShipment:function(e){var n=germanized.admin.shipments.getShipments();return!!n.hasOwnProperty(e)&&n[e]},refresh:function(e){},refreshItems:function(e){},addItem:function(){},initTiptip:function(){germanized.admin.shipments.$wrapper.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})}},m(document).ready(function(){germanized.admin.shipments.init()})}(jQuery);
!function(l,o,c){l(function(){var e=l(".wc-gzd-shipments-shipping-rules-rows"),i=l(".wc-gzd-shipments-shipping-rules"),n=c.template("wc-gzd-shipments-shipping-rules-row"),t=c.template("wc-gzd-shipments-shipping-rules-packaging-info"),d={},s=Backbone.Model.extend({updateRules:function(e,i){0===Object.keys(e).length&&(e={});var n={...this.get("rules")};n[String(i)]=e,this.set("rules",n)},getRulesByPackaging:function(e){var i={...this.get("rules")};return i.hasOwnProperty(String(e))?i[String(e)]:[]}}),a=Backbone.View.extend({rowTemplate:n,packaging:"",initialize:function(){this.packaging=String(l(this.el).data("packaging")),l(this.el).on("change",{view:this},this.updateModelOnChange)},block:function(){l(this.el).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){l(this.el).unblock()},getRules:function(){return this.model.getRulesByPackaging(this.packaging)},render:function(){var e=this.getRules(),n=this;this.$el.empty(),this.unblock(),_.size(e)&&l.each(e,function(e,i){n.renderRow(i)})},renderRow:function(e){var i=this;i.$el.append(i.rowTemplate(e)),i.initRow(e)},initRow:function(i){var e=this.$el.find('tr[data-id="'+i.rule_id+'"]'),n=e.parents("tbody");e.find("select").each(function(){var e=l(this).data("attribute");l(this).find('option[value="'+i[e]+'"]').prop("selected",!0)}),e.find(".shipping-rules-type-container").hide(),e.find(".conditions-column:not(.conditions-when)").hide(),e.find(".shipping-rules-type").on("change",{view:this},this.onChangeRuleType),e.find(".shipping-rules-type").trigger("change"),n.find("tr.wc-gzd-shipments-shipping-rules-packaging-info").length<=0&&(n.prepend(t),(e=n.find("tr.wc-gzd-shipments-shipping-rules-packaging-info")).find(".packaging-title").html(n.data("title")),n.data("help-tip")?e.find(".woocommerce-help-tip").attr("data-tip",n.data("help-tip")):e.find(".woocommerce-help-tip").remove()),l(document.body).trigger("wc-enhanced-select-init"),l(document.body).trigger("init_tooltips")},onChangeRuleType:function(e){var i=l(this).closest("tr"),n=l(this).val();i.find(".shipping-rules-type-container").hide(),i.find(".conditions-column:not(.conditions-when)").hide(),i.find(".shipping-rules-type-container-"+n).show(),i.find(".shipping-rules-type-container-"+n).parents(".conditions-column").show()},onAddNewRow:function(e){e.preventDefault();var i=e.data.view,n=i.model,t=i.getRules(),e=_.size(t),e=_.extend({},o.default_shipping_rule,{rule_id:"new-"+e+"-"+Date.now(),newRow:!0});t[e.rule_id]=e,n.updateRules(t,i.packaging),i.renderRow(e),l(".wc-gzd-shipments-shipping-rules-blank-state").remove()},onDeleteRow:function(e){var i=e.data.view,n=i.model,t=_.indexBy(n.get("rules"),"rule_id"),s=l(this).closest("tr").data("id");e.preventDefault(),t[s]&&(delete t[s],n.set("rules",t)),i.render()},updateModelOnChange:function(e){var i=e.data.view,n=i.model,t=l(e.target),s=t.closest("tr").data("id"),a=t.data("attribute"),r=t.val(),e=i.getRules();t.is(":checkbox")&&(r=t.is(":checked")?r:""),e[s]&&String(e[s][a])===String(r)||(e[s][a]=r,String(e[s].packaging)!==String(i.packaging)?(t=e[s].packaging,(r=(a=d[t]).getRules())[s]={...e[s]},delete e[s],n.updateRules(e,i.packaging),a.model.updateRules(r,t),i.render(),a.render()):n.updateRules(e,i.packaging))}}),r=new s({rules:o.rules});e.each(function(){var e=new a({model:r,el:l(this)});e.render(),d[l(this).data("packaging")]=e,l(this).sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,helper:function(e,i){return i.children().each(function(){l(this).width(l(this).width())}),i.css("left","0"),i},start:function(e,i){i.item.css("background-color","#f6f6f6")},stop:function(e,i){i.item.removeAttr("style"),i.item.trigger("updateMoveButtons")}})}),l(document).on("click",".wc-gzd-shipments-shipping-rule-add",function(){var e=l(".new-shipping-packaging").val(),i=d[e],n=i.model.getRulesByPackaging(e),t=_.extend({},o.default_shipping_rule,{rule_id:"new-"+_.size(n)+"-"+Date.now(),packaging:e,newRow:!0});return n[t.rule_id]=t,i.model.updateRules(n,e),d[e].renderRow(t),!1}),l(document).on("change",".wc-gzd-shipments-shipping-rules-rows input.cb",function(){$selected=l(this).parents("table").find("input.cb:checked"),0<$selected.length?i.find(".wc-gzd-shipments-shipping-rule-remove").removeClass("disabled"):i.find(".wc-gzd-shipments-shipping-rule-remove").addClass("disabled")}),l(document).on("click",".wc-gzd-shipments-shipping-rule-remove",function(){var n=r.get("rules"),e=l(this),i=e.parents("table"),t=[];return i.find("input.cb:checked").each(function(){var e=l(this).val(),i=l(this).parents("tr").find(".shipping-packaging").val();t.includes(i)||t.push(i),delete n[i][e]}),r.set("rules",n),t.forEach(function(e,i){d[e].render()}),e.addClass("disabled"),!1})})}(jQuery,wc_gzd_admin_shipping_rules_params,wp,ajaxurl);
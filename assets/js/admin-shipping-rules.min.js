!function(d,r,o){d(function(){var e=d(".wc-gzd-shipments-shipping-rules-rows"),n=d(".wc-gzd-shipments-shipping-rules"),i=(d(".wc-gzd-shipments-shipping-rules-save"),o.template("wc-gzd-shipments-shipping-rules-row")),l=(o.template("wc-gzd-shipments-shipping-rules-row-blank"),o.template("wc-gzd-shipments-shipping-rules-row-actions"),{}),t=Backbone.Model.extend({updateRules:function(e,n){0===Object.keys(e).length&&(e={});var i={...this.get("rules")};i[parseInt(n)]=e,this.set("rules",i)},getRulesByPackaging:function(e){var n={...this.get("rules")};return n.hasOwnProperty(e)?n[parseInt(e)]:[]}}),s=Backbone.View.extend({rowTemplate:i,packaging:"",initialize:function(){this.packaging=d(this.el).data("packaging"),d(this.el).on("change",{view:this},this.updateModelOnChange)},block:function(){d(this.el).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){d(this.el).unblock()},getRules:function(){return this.model.getRulesByPackaging(this.packaging)},render:function(){var e=this.getRules(),i=this;this.$el.empty(),this.unblock(),_.size(e)&&d.each(e,function(e,n){i.renderRow(n)})},renderRow:function(e){var n=this;n.$el.append(n.rowTemplate(e)),n.initRow(e)},initRow:function(n){var e=this.$el.find('tr[data-id="'+n.rule_id+'"]');e.find("select").each(function(){var e=d(this).data("attribute");d(this).find('option[value="'+n[e]+'"]').prop("selected",!0)}),e.find(".shipping-rules-type-container").hide(),e.find(".conditions-column:not(.conditions-when)").hide(),e.find(".shipping-rules-type").on("change",{view:this},this.onChangeRuleType),e.find(".shipping-rules-type").trigger("change"),d(document.body).trigger("wc-enhanced-select-init")},onChangeRuleType:function(e){var n=d(this).closest("tr"),i=d(this).val();n.find(".shipping-rules-type-container").hide(),n.find(".conditions-column:not(.conditions-when)").hide(),n.find(".shipping-rules-type-container-"+i).show(),n.find(".shipping-rules-type-container-"+i).parents(".conditions-column").show()},onAddNewRow:function(e){e.preventDefault();var n=e.data.view,i=n.model,t=n.getRules(),e=_.size(t),e=_.extend({},r.default_shipping_rule,{rule_id:"new-"+e+"-"+Date.now(),newRow:!0});t[e.rule_id]=e,i.updateRules(t,n.packaging),n.renderRow(e),d(".wc-gzd-shipments-shipping-rules-blank-state").remove()},onDeleteRow:function(e){var n=e.data.view,i=n.model,t=_.indexBy(i.get("rules"),"rule_id"),s=d(this).closest("tr").data("id");e.preventDefault(),t[s]&&(delete t[s],i.set("rules",t)),n.render()},updateModelOnChange:function(e){var n=e.data.view,i=n.model,t=d(e.target),s=t.closest("tr").data("id"),a=t.data("attribute"),r=t.val(),e=n.getRules();t.is(":checkbox")&&(r=t.is(":checked")?r:""),e[s]&&String(e[s][a])===String(r)||(e[s][a]=r,String(e[s].packaging)!==String(n.packaging)?(t=e[s].packaging,(r=(a=l[t]).getRules())[s]={...e[s]},delete e[s],i.updateRules(e,n.packaging),a.model.updateRules(r,t),n.render(),a.render()):i.updateRules(e,n.packaging))}}),a=new t({rules:r.rules});e.each(function(){var e=new s({model:a,el:d(this)});e.render(),l[d(this).data("packaging")]=e,d(this).sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,helper:function(e,n){return n.children().each(function(){d(this).width(d(this).width())}),n.css("left","0"),n},start:function(e,n){n.item.css("background-color","#f6f6f6")},stop:function(e,n){n.item.removeAttr("style"),n.item.trigger("updateMoveButtons")}})}),d(document).on("click",".wc-gzd-shipments-shipping-rule-add",function(){var e=d(".new-shipping-packaging").val(),n=l[e],i=n.model.getRulesByPackaging(e),t=_.extend({},r.default_shipping_rule,{rule_id:"new-"+_.size(i)+"-"+Date.now(),packaging:e,newRow:!0});return i[t.rule_id]=t,n.model.updateRules(i,e),l[e].renderRow(t),!1}),d(document).on("change",".wc-gzd-shipments-shipping-rules-rows input.cb",function(){$selected=d(this).parents("table").find("input.cb:checked"),0<$selected.length?n.find(".wc-gzd-shipments-shipping-rule-remove").removeClass("disabled"):n.find(".wc-gzd-shipments-shipping-rule-remove").addClass("disabled")}),d(document).on("click",".wc-gzd-shipments-shipping-rule-remove",function(){var i=a.get("rules"),e=d(this),n=e.parents("table"),t=[];return n.find("input.cb:checked").each(function(){var e=d(this).val(),n=d(this).parents("tr").find(".shipping-packaging").val();t.includes(n)||t.push(n),delete i[n][e]}),a.set("rules",i),t.forEach(function(e,n){l[e].render()}),e.addClass("disabled"),!1})})}(jQuery,wc_gzd_admin_shipping_rules_params,wp,ajaxurl);